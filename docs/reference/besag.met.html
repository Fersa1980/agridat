<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Multi-environment trial of corn, incomplete-block design — besag.met • agridat</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Multi-environment trial of corn, incomplete-block design — besag.met" />
<meta property="og:description" content="Multi-environment trial of corn, incomplete-block designlocation." />
<meta property="og:image" content="/logo.png" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">agridat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.17</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/agridat_data.html">Additional sources of agricultural data</a>
    </li>
    <li>
      <a href="../articles/agridat_examples.html">Graphical Gems in the agridat Package</a>
    </li>
    <li>
      <a href="../articles/agridat_papadakis.html">Using Papadakis covariates for nearest neighbor analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Multi-environment trial of corn, incomplete-block design</h1>
    
    <div class="hidden name"><code>besag.met.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Multi-environment trial of corn, incomplete-block designlocation.</p>
    </div>



    <h2 class="hasAnchor" id="format"><a class="anchor" href="#format"></a>Format</h2>

    <p>A data frame with 1152 observations on the following 7 variables.</p><dl class='dl-horizontal'>
    <dt><code>county</code></dt><dd><p>county</p></dd>
    <dt><code>row</code></dt><dd><p>row</p></dd>
    <dt><code>col</code></dt><dd><p>column</p></dd>
    <dt><code>rep</code></dt><dd><p>rep</p></dd>
    <dt><code>block</code></dt><dd><p>incomplete block</p></dd>
    <dt><code>yield</code></dt><dd><p>yield</p></dd>
    <dt><code>gen</code></dt><dd><p>genotype, 1-64</p></dd>
  
</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    

<p>Multi-environment trial of 64 corn hybrids in six counties in North
  Carolina.  Each location had 3 replicates in in incomplete-block
  design with an 18x11 lattice of plots whose length-to-width ratio was
  about 2:1.</p>
<p>Note: In the original data, each county had 6 missing plots.  This
  data has rows for each missing plot that uses the same
  county/block/rep to fill-out the row, sets the genotype to G01, and
  sets the yield to missing.  These missing values were added to the
  data so that asreml could more easily do AR1xAR1 analysis using
  rectangular regions.</p>
<p>Each location/panel is:</p>  
<p>Field length: 18 rows * 2 units = 36 units.</p>
<p>Field width: 11 plots * 1 unit = 11 units.</p>
    <h2 class="hasAnchor" id="source"><a class="anchor" href="#source"></a>Source</h2>

    <p>Julian Besag and D Higdon, 1999.
  Bayesian Analysis of Agricultural Field Experiments,
  <em>Journal of the Royal Statistical Society: Series B (Statistical
    Methodology)</em>, 61, 691--746. Table 1.</p>
<p>http://doi.org/10.1111/1467-9868.00201</p>
<p>Retrieved from
  http://web.archive.org/web/19990505223413/www.stat.duke.edu/~higdon/trials/nc.dat</p>
<p>Used with permission of David Higdon.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \dontrun{</span>

<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>agridat</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>besag.met</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>besag.met</span>

<span class='fu'><a href='libs.html'>libs</a></span>(<span class='no'>desplot</span>)
<span class='fu'>desplot</span>(<span class='no'>yield</span> ~ <span class='no'>col</span>*<span class='no'>row</span><span class='kw'>|</span><span class='no'>county</span>, <span class='no'>dat</span>,
        <span class='kw'>aspect</span><span class='kw'>=</span><span class='fl'>36</span>/<span class='fl'>11</span>, <span class='co'># true aspect</span>
        <span class='kw'>out1</span><span class='kw'>=</span><span class='no'>rep</span>, <span class='kw'>out2</span><span class='kw'>=</span><span class='no'>block</span>,
        <span class='kw'>main</span><span class='kw'>=</span><span class='st'>"besag.met"</span>)</div><div class='img'><img src='besag.met-1.png' alt='' width='700' height='433' /></div><div class='input'>

<span class='co'># Average reps</span>
<span class='no'>datm</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/aggregate.html'>aggregate</a></span>(<span class='no'>yield</span> ~ <span class='no'>county</span> + <span class='no'>gen</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>FUN</span><span class='kw'>=</span><span class='no'>mean</span>)

<span class='co'># Sections below fit heteroskedastic variance models (variance for each variety)</span>
<span class='co'># asreml takes 1 second, lme 73 seconds, SAS PROC MIXED 30 minutes</span>



<span class='co'># lme</span>
<span class='co'># libs(nlme)</span>
<span class='co'># m1l &lt;- lme(yield ~ -1 + gen, data=datm, random=~1|county,</span>
<span class='co'>#            weights = varIdent(form=~ 1|gen))</span>
<span class='co'># m1l$sigma^2 * c(1, coef(m1l$modelStruct$varStruct, unc = FALSE))^2</span>
<span class='co'>##           G02    G03    G04    G05    G06    G07    G08</span>
<span class='co'>##  91.90 210.75  63.03 112.05  28.39 237.36  72.72  42.97</span>
<span class='co'>## ... etc ...</span>



<span class='kw'>if</span>(<span class='fl'>0</span>){
  <span class='co'># asreml3</span>
  <span class='fu'><a href='libs.html'>libs</a></span>(<span class='no'>asreml</span>)

  <span class='co'># asreml Using 'rcov' ALWAYS requires sorting the data</span>

  <span class='no'>datm</span> <span class='kw'>&lt;-</span> <span class='no'>datm</span>[<span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span>(<span class='no'>datm</span>$<span class='no'>gen</span>),]
  <span class='no'>m1a</span> <span class='kw'>&lt;-</span> <span class='fu'>asreml</span>(<span class='no'>yield</span> ~ <span class='no'>gen</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>datm</span>,
                <span class='kw'>random</span> <span class='kw'>=</span> ~ <span class='no'>county</span>,
                <span class='kw'>rcov</span> <span class='kw'>=</span> ~ <span class='fu'>at</span>(<span class='no'>gen</span>):<span class='no'>units</span>,
                <span class='kw'>predict</span><span class='kw'>=</span><span class='kw pkg'>asreml</span><span class='kw ns'>:::</span><span class='fu'><a href='https://rdrr.io/pkg/asreml/man/predict.asreml.html'>predict.asreml</a></span>(<span class='kw'>classify</span><span class='kw'>=</span><span class='st'>"gen"</span>))

  <span class='fu'><a href='libs.html'>libs</a></span>(<span class='no'>lucid</span>)
  <span class='fu'>vc</span>(<span class='no'>m1a</span>)[<span class='fl'>1</span>:<span class='fl'>7</span>,]
  <span class='co'>##             effect component std.error z.ratio constr</span>
  <span class='co'>##  county!county.var   1324       838.2      1.6    pos</span>
  <span class='co'>##   gen_G01!variance     91.93     58.82     1.6    pos</span>
  <span class='co'>##   gen_G02!variance    210.7     133.9      1.6    pos</span>
  <span class='co'>##   gen_G03!variance     63.03     40.53     1.6    pos</span>
  <span class='co'>##   gen_G04!variance    112.1      71.53     1.6    pos</span>
  <span class='co'>##   gen_G05!variance     28.39     18.63     1.5    pos</span>
  <span class='co'>##   gen_G06!variance    237.4     150.8      1.6    pos</span>


  <span class='co'># We get the same results from asreml &amp; lme</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>m1a</span>$<span class='no'>gammas</span>[-<span class='fl'>1</span>],
       <span class='no'>m1l</span>$<span class='no'>sigma</span>^<span class='fl'>2</span> * <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>m1l</span>$<span class='no'>modelStruct</span>$<span class='no'>varStruct</span>, <span class='kw'>unc</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>))^<span class='fl'>2</span>)


  <span class='co'># The following example shows how to construct a GxE biplot</span>
  <span class='co'># from the FA2 model.</span>

  <span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>besag.met</span>
  <span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/transform.html'>transform</a></span>(<span class='no'>dat</span>, <span class='kw'>xf</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='no'>col</span>), <span class='kw'>yf</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='no'>row</span>))
  <span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>dat</span>[<span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span>(<span class='no'>dat</span>$<span class='no'>county</span>, <span class='no'>dat</span>$<span class='no'>xf</span>, <span class='no'>dat</span>$<span class='no'>yf</span>), ]

  <span class='co'># First, AR1xAR1</span>
  <span class='no'>m1</span> <span class='kw'>&lt;-</span> <span class='fu'>asreml</span>(<span class='no'>yield</span> ~ <span class='no'>county</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>,
               <span class='kw'>random</span> <span class='kw'>=</span> ~ <span class='no'>gen</span>:<span class='no'>county</span>,
               <span class='kw'>rcov</span> <span class='kw'>=</span> ~ <span class='fu'>at</span>(<span class='no'>county</span>):<span class='fu'>ar1</span>(<span class='no'>xf</span>):<span class='fu'>ar1</span>(<span class='no'>yf</span>))
  <span class='co'># Add FA1.</span>
  <span class='co'># For ASExtras:::summary.fa, use fa(county,1):gen, NOT gen:fa(county,1)</span>
  <span class='no'>m2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span>(<span class='no'>m1</span>, <span class='kw'>random</span><span class='kw'>=</span>~<span class='fu'>fa</span>(<span class='no'>county</span>,<span class='fl'>1</span>):<span class='no'>gen</span>)
  <span class='co'># FA2</span>
  <span class='no'>m3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span>(<span class='no'>m2</span>, <span class='kw'>random</span><span class='kw'>=</span>~<span class='fu'>fa</span>(<span class='no'>county</span>,<span class='fl'>2</span>):<span class='no'>gen</span>)

  <span class='co'># Use the loadings to make a biplot</span>
  <span class='no'>vars</span> <span class='kw'>&lt;-</span> <span class='fu'>vc</span>(<span class='no'>m3</span>)
  <span class='no'>psi</span> <span class='kw'>&lt;-</span> <span class='no'>vars</span>[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='st'>".var$"</span>, <span class='no'>vars</span>$<span class='no'>effect</span>), <span class='st'>"component"</span>]
  <span class='no'>la1</span> <span class='kw'>&lt;-</span> <span class='no'>vars</span>[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='st'>".fa1$"</span>, <span class='no'>vars</span>$<span class='no'>effect</span>), <span class='st'>"component"</span>]
  <span class='no'>la2</span> <span class='kw'>&lt;-</span> <span class='no'>vars</span>[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='st'>".fa2$"</span>, <span class='no'>vars</span>$<span class='no'>effect</span>), <span class='st'>"component"</span>]
  <span class='no'>mat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='no'>psi</span>, <span class='no'>la1</span>, <span class='no'>la2</span>))
  <span class='no'>rot</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/svd.html'>svd</a></span>(<span class='no'>mat</span>[,-<span class='fl'>1</span>])$<span class='no'>v</span> <span class='co'># rotation matrix</span>
  <span class='no'>lam</span> <span class='kw'>&lt;-</span> <span class='no'>mat</span>[,-<span class='fl'>1</span>]
  <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>lam</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"load1"</span>, <span class='st'>"load2"</span>)

  <span class='no'>co3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>m3</span>)$<span class='no'>random</span> <span class='co'># Scores are the GxE coefficients</span>
  <span class='no'>ix1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='st'>"_Comp1:gen"</span>, <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>co3</span>))
  <span class='no'>ix2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='st'>"_Comp2:gen"</span>, <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>co3</span>))
  <span class='no'>sco</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>co3</span>[<span class='no'>ix1</span>], <span class='no'>co3</span>[<span class='no'>ix2</span>]), <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>2</span>, <span class='kw'>byrow</span><span class='kw'>=</span><span class='fl'>FALSE</span>)
  <span class='no'>sco</span> <span class='kw'>&lt;-</span> <span class='no'>sco</span>
  <span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>sco</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span>(<span class='no'>dat</span>$<span class='no'>gen</span>) , <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'load1'</span>,<span class='st'>'load2'</span>))
  <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>lam</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span>(<span class='no'>dat</span>$<span class='no'>county</span>)
  <span class='no'>sco</span>[,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span> * <span class='no'>sco</span>[,<span class='fl'>1</span>]
  <span class='no'>lam</span>[,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span> * <span class='no'>lam</span>[,<span class='fl'>1</span>]
  <span class='fu'><a href='https://rdrr.io/r/stats/biplot.html'>biplot</a></span>(<span class='no'>sco</span>, <span class='no'>lam</span>, <span class='kw'>cex</span><span class='kw'>=</span><span class='fl'>.5</span>, <span class='kw'>main</span><span class='kw'>=</span><span class='st'>"FA2 coefficient biplot"</span>)
  <span class='co'># G variance matrix</span>
  <span class='no'>gvar</span> <span class='kw'>&lt;-</span> <span class='no'>lam</span>

  <span class='co'># Now get predictions and make an ordinary biplot</span>
  <span class='no'>p3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>m3</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>classify</span><span class='kw'>=</span><span class='st'>"county:gen"</span>)
  <span class='no'>p3</span> <span class='kw'>&lt;-</span> <span class='no'>p3</span>$<span class='no'>pred</span>$<span class='no'>pval</span>
  <span class='fu'><a href='libs.html'>libs</a></span>(<span class='st'>"gge"</span>)
  <span class='no'>bi3</span> <span class='kw'>&lt;-</span> <span class='fu'>gge</span>(<span class='no'>predicted.value</span> ~ <span class='no'>gen</span>*<span class='no'>county</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>p3</span>, <span class='kw'>scale</span><span class='kw'>=</span><span class='fl'>FALSE</span>)
  <span class='kw'>if</span>(<span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>()) <span class='fu'><a href='https://rdrr.io/r/grDevices/dev.html'>dev.new</a></span>()
  <span class='co'># Very similar to the coefficient biplot</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/biplot.html'>biplot</a></span>(<span class='no'>bi3</span>, <span class='kw'>stand</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='co'># what does 'stand' do?</span>
         <span class='kw'>main</span><span class='kw'>=</span><span class='st'>"SVD biplot of FA2 predictions"</span>)

  <span class='co'># latent factor plots and more</span>
  <span class='kw'>if</span>(<span class='fl'>FALSE</span>) {
    <span class='fu'><a href='libs.html'>libs</a></span>(<span class='no'>ASExtras</span>)
    <span class='kw pkg'>ASExtras</span><span class='kw ns'>:::</span><span class='fu'>summary.fa</span>(<span class='no'>m3</span>, <span class='kw'>g.list</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"G01"</span>,<span class='st'>"G02"</span>,<span class='st'>"G03"</span>,<span class='st'>"G04"</span>,<span class='st'>"G05"</span>,<span class='st'>"G06"</span>,<span class='st'>"G07"</span>,<span class='st'>"G08"</span>))
    <span class='no'>out</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>ASExtras</span><span class='kw ns'>:::</span><span class='fu'>summary.fa</span>(<span class='no'>m3</span>,<span class='kw'>uniplot</span><span class='kw'>=</span><span class='fl'>0</span>,<span class='kw'>blups</span><span class='kw'>=</span><span class='fl'>1</span>,<span class='kw'>regplot</span><span class='kw'>=</span><span class='fl'>1</span>,<span class='kw'>addedplot</span><span class='kw'>=</span><span class='fl'>0</span>,<span class='kw'>heatmap</span><span class='kw'>=</span><span class='fl'>0</span>)
    <span class='no'>loads</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span>(<span class='no'>out</span>$<span class='no'>gammas</span>$<span class='no'>`fa(county, 2):gen`</span>$<span class='no'>`rotated loads`</span>)
    <span class='no'>loads</span>$<span class='no'>county</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>loads</span>)

    <span class='no'>regdat</span> <span class='kw'>&lt;-</span> <span class='no'>out</span>$<span class='no'>blups</span>$<span class='no'>`fa(county, 2):gen`</span>$<span class='no'>blups.inmet</span>
    <span class='no'>regdat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/merge.html'>merge</a></span>(<span class='no'>regdat</span>, <span class='no'>loads</span>)

    <span class='fu'><a href='libs.html'>libs</a></span>(<span class='no'>latticeExtra</span>)
    <span class='fu'>xyplot</span>(<span class='no'>blup</span> ~ <span class='no'>fac_1</span><span class='kw'>|</span><span class='no'>gen</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>regdat</span>, <span class='kw'>as.table</span><span class='kw'>=</span><span class='fl'>TRUE</span>)+
      <span class='fu'>xyplot</span>(<span class='no'>regblup</span> ~ <span class='no'>fac_1</span><span class='kw'>|</span><span class='no'>gen</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>regdat</span>,
             <span class='kw'>as.table</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>'r'</span>)
    }

}

 <span class='co'>##  libs(asreml4)</span>

 <span class='co'>##  # asreml Using 'rcov' ALWAYS requires sorting the data</span>
 <span class='co'>##  datm &lt;- datm[order(datm$gen),]</span>

 <span class='co'>##  m1 &lt;- asreml(yield ~ gen, data=datm,</span>
 <span class='co'>##               random = ~ county,</span>
 <span class='co'>##               resid = ~ dsum( ~ units|gen))</span>
 <span class='co'>##  #summary(m1)$varcomp[1:7,]</span>
 <span class='co'>##  libs(lucid)</span>
 <span class='co'>##  vc(m1)[1:7,]</span>
 <span class='co'>## ##     effect component std.error z.ratio bound </span>
 <span class='co'>## ##     county   1324       838.2      1.6     P 0  </span>
 <span class='co'>## ## gen_G01(R)     91.95     58.85     1.6     P 0  </span>
 <span class='co'>## ## gen_G02(R)    210.7     133.8      1.6     P 0.1</span>
 <span class='co'>## ## gen_G03(R)     63.04     40.55     1.6     P 0  </span>
 <span class='co'>## ## gen_G04(R)    112.1      71.54     1.6     P 0  </span>
 <span class='co'>## ## gen_G05(R)     28.38     18.61     1.5     P 0.1</span>
 <span class='co'>## ## gen_G06(R)    237.4     150.8      1.6     P 0  </span>

 <span class='co'>##  # We get the same results from asreml &amp; lme</span>
 <span class='co'>##  plot(m1$vparameters[-1],</span>
 <span class='co'>##     m1l$sigma^2 * c(1, coef(m1l$modelStruct$varStruct, unc = FALSE))^2)</span>

 <span class='co'>##  # The following example shows how to construct a GxE biplot</span>
 <span class='co'>##  # from the FA2 model.</span>

 <span class='co'>##  dat &lt;- besag.met</span>
 <span class='co'>##  dat &lt;- transform(dat, xf=factor(col), yf=factor(row))</span>
 <span class='co'>##  dat &lt;- dat[order(dat$county, dat$xf, dat$yf), ]</span>

 <span class='co'>##  # First, AR1xAR1</span>
 <span class='co'>##  m1 &lt;- asreml(yield ~ county, data=dat,</span>
 <span class='co'>##               random = ~ gen:county,</span>
 <span class='co'>##               resid = ~ dsum( ~ ar1(xf):ar1(yf)|county))</span>

 <span class='co'>##  # Add FA1</span>
 <span class='co'>##  m2 &lt;- update(m1, random=~gen:fa(county,1))</span>
 <span class='co'>##  # FA2</span>
 <span class='co'>##  m3 &lt;- update(m2, random=~gen:fa(county,2))</span>

 <span class='co'>##  # Use the loadings to make a biplot</span>
 <span class='co'>##  vars &lt;- vc(m3)</span>
 <span class='co'>##  psi &lt;- vars[grepl("!var$", vars$effect), "component"]</span>
 <span class='co'>##  la1 &lt;- vars[grepl("!fa1$", vars$effect), "component"]</span>
 <span class='co'>##  la2 &lt;- vars[grepl("!fa2$", vars$effect), "component"]</span>
 <span class='co'>##  mat &lt;- as.matrix(data.frame(psi, la1, la2))</span>
 <span class='co'>##  rot &lt;- svd(mat[,-1])$v # rotation matrix</span>
 <span class='co'>##  lam &lt;- mat[,-1] </span>
 <span class='co'>##  colnames(lam) &lt;- c("load1", "load2")</span>

 <span class='co'>##  co3 &lt;- coef(m3)$random # Scores are the GxE coefficients</span>
 <span class='co'>##  ix1 &lt;- grepl("_Comp1$", rownames(co3))</span>
 <span class='co'>##  ix2 &lt;- grepl("_Comp2$", rownames(co3))</span>
 <span class='co'>##  sco &lt;- matrix(c(co3[ix1], co3[ix2]), ncol=2, byrow=FALSE)</span>
 <span class='co'>##  sco &lt;- sco </span>
 <span class='co'>##  dimnames(sco) &lt;- list(levels(dat$gen) , c('load1','load2'))</span>
 <span class='co'>##  rownames(lam) &lt;- levels(dat$county)</span>
 <span class='co'>##  sco[,1] &lt;- -1 * sco[,1]</span>
 <span class='co'>##  lam[,1] &lt;- -1 * lam[,1]</span>
 <span class='co'>##  biplot(sco, lam, cex=.5, main="FA2 coefficient biplot")</span>
 <span class='co'>##  # G variance matrix</span>
 <span class='co'>##  gvar &lt;- lam </span>

 <span class='co'>##  # Now get predictions and make an ordinary biplot</span>
 <span class='co'>##  p3 &lt;- predict(m3, data=dat, classify="county:gen")</span>
 <span class='co'>##  p3 &lt;- p3$pvals</span>
 <span class='co'>##  libs("gge")  </span>
 <span class='co'>##  bi3 &lt;- gge(predicted.value ~ gen*county, data=p3, scale=FALSE)</span>
 <span class='co'>##  if(interactive()) dev.new()</span>
 <span class='co'>##  # Very similar to the coefficient biplot</span>
 <span class='co'>##  biplot(bi3, stand=FALSE, main="SVD biplot of FA2 predictions")</span>

<span class='co'># }</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#format">Format</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#source">Source</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Kevin Wright.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


