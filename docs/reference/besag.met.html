<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Multi-environment trial of corn, incomplete-block design — besag.met • agridat</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Multi-environment trial of corn, incomplete-block design — besag.met" />
<meta property="og:description" content="Multi-environment trial of corn, incomplete-block designlocation." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">agridat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.17</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/agridat_data.html">Additional sources of agricultural data</a>
    </li>
    <li>
      <a href="../articles/agridat_examples.html">Graphical Gems in the agridat Package</a>
    </li>
    <li>
      <a href="../articles/agridat_intro.html">Introduction to `agridat`</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/kwstat/agridat/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Multi-environment trial of corn, incomplete-block design</h1>
    
    <div class="hidden name"><code>besag.met.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Multi-environment trial of corn, incomplete-block designlocation.</p>
    </div>



    <h2 class="hasAnchor" id="format"><a class="anchor" href="#format"></a>Format</h2>

    <p>A data frame with 1152 observations on the following 7 variables.</p><dl'>
    <dt><code>county</code></dt><dd><p>county</p></dd>
    <dt><code>row</code></dt><dd><p>row</p></dd>
    <dt><code>col</code></dt><dd><p>column</p></dd>
    <dt><code>rep</code></dt><dd><p>rep</p></dd>
    <dt><code>block</code></dt><dd><p>incomplete block</p></dd>
    <dt><code>yield</code></dt><dd><p>yield</p></dd>
    <dt><code>gen</code></dt><dd><p>genotype, 1-64</p></dd>
  
</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    

<p>Multi-environment trial of 64 corn hybrids in six counties in North
  Carolina.  Each location had 3 replicates in in incomplete-block
  design with an 18x11 lattice of plots whose length-to-width ratio was
  about 2:1.</p>
<p>Note: In the original data, each county had 6 missing plots.  This
  data has rows for each missing plot that uses the same
  county/block/rep to fill-out the row, sets the genotype to G01, and
  sets the yield to missing.  These missing values were added to the
  data so that asreml could more easily do AR1xAR1 analysis using
  rectangular regions.</p>
<p>Each location/panel is:</p>  
<p>Field length: 18 rows * 2 units = 36 units.</p>
<p>Field width: 11 plots * 1 unit = 11 units.</p>
  
<p>Retrieved from
  http://web.archive.org/web/19990505223413/www.stat.duke.edu/~higdon/trials/nc.dat</p>
<p>Used with permission of David Higdon.</p>
    <h2 class="hasAnchor" id="source"><a class="anchor" href="#source"></a>Source</h2>

    <p>Julian Besag and D Higdon, 1999.
  Bayesian Analysis of Agricultural Field Experiments,
  Journal of the Royal Statistical Society: Series B, 61, 691--746.
  Table 1.
  http://doi.org/10.1111/1467-9868.00201</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \dontrun{</span>

  <span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>agridat</span>)
  <span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>besag.met</span>)
  <span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>besag.met</span>

  <span class='fu'><a href='libs.html'>libs</a></span>(<span class='no'>desplot</span>)
  <span class='fu'>desplot</span>(<span class='no'>dat</span>, <span class='no'>yield</span> ~ <span class='no'>col</span>*<span class='no'>row</span><span class='kw'>|</span><span class='no'>county</span>,
          <span class='kw'>aspect</span><span class='kw'>=</span><span class='fl'>36</span>/<span class='fl'>11</span>, <span class='co'># true aspect</span>
          <span class='kw'>out1</span><span class='kw'>=</span><span class='no'>rep</span>, <span class='kw'>out2</span><span class='kw'>=</span><span class='no'>block</span>,
          <span class='kw'>main</span><span class='kw'>=</span><span class='st'>"besag.met"</span>)</div><div class='img'><img src='besag.met-1.png' alt='' width='700' height='433' /></div><div class='input'>

  <span class='co'># Average reps</span>
  <span class='no'>datm</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/aggregate.html'>aggregate</a></span>(<span class='no'>yield</span> ~ <span class='no'>county</span> + <span class='no'>gen</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>FUN</span><span class='kw'>=</span><span class='no'>mean</span>)

  <span class='co'># Sections below fit heteroskedastic variance models (variance for each variety)</span>
  <span class='co'># asreml takes 1 second, lme 73 seconds, SAS PROC MIXED 30 minutes</span>



  <span class='co'># lme</span>
  <span class='co'># libs(nlme)</span>
  <span class='co'># m1l &lt;- lme(yield ~ -1 + gen, data=datm, random=~1|county,</span>
  <span class='co'>#            weights = varIdent(form=~ 1|gen))</span>
  <span class='co'># m1l$sigma^2 * c(1, coef(m1l$modelStruct$varStruct, unc = FALSE))^2</span>
  <span class='co'>##           G02    G03    G04    G05    G06    G07    G08</span>
  <span class='co'>##  91.90 210.75  63.03 112.05  28.39 237.36  72.72  42.97</span>
  <span class='co'>## ... etc ...</span>


  <span class='co'># Note, the FA biplots from asreml3 and asreml4 are surprisingly</span>
  <span class='co'># different from each other.  The predicted-value biplots are</span>
  <span class='co'># almost identical.</span>

  <span class='fu'><a href='libs.html'>libs</a></span>(<span class='no'>asreml</span>)
  <span class='kw'>if</span>( <span class='kw pkg'>utils</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/packageDescription.html'>packageVersion</a></span>(<span class='st'>"asreml"</span>) <span class='kw'>&lt;</span> <span class='st'>"4"</span>) {
    <span class='co'># asreml3</span>

    <span class='co'># asreml Using 'rcov' ALWAYS requires sorting the data</span>
    <span class='no'>datm</span> <span class='kw'>&lt;-</span> <span class='no'>datm</span>[<span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span>(<span class='no'>datm</span>$<span class='no'>gen</span>),]
    <span class='no'>m1a</span> <span class='kw'>&lt;-</span> <span class='fu'>asreml</span>(<span class='no'>yield</span> ~ <span class='no'>gen</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>datm</span>,
                  <span class='kw'>random</span> <span class='kw'>=</span> ~ <span class='no'>county</span>,
                  <span class='kw'>rcov</span> <span class='kw'>=</span> ~ <span class='fu'>at</span>(<span class='no'>gen</span>):<span class='no'>units</span>)

    <span class='fu'><a href='libs.html'>libs</a></span>(<span class='no'>lucid</span>)
    <span class='fu'>vc</span>(<span class='no'>m1a</span>)[<span class='fl'>1</span>:<span class='fl'>7</span>,]
    <span class='co'>##             effect component std.error z.ratio constr</span>
    <span class='co'>##  county!county.var   1324       838.2      1.6    pos</span>
    <span class='co'>##   gen_G01!variance     91.93     58.82     1.6    pos</span>
    <span class='co'>##   gen_G02!variance    210.7     133.9      1.6    pos</span>
    <span class='co'>##   gen_G03!variance     63.03     40.53     1.6    pos</span>
    <span class='co'>##   gen_G04!variance    112.1      71.53     1.6    pos</span>
    <span class='co'>##   gen_G05!variance     28.39     18.63     1.5    pos</span>
    <span class='co'>##   gen_G06!variance    237.4     150.8      1.6    pos</span>


    <span class='co'># We get the same results from asreml &amp; lme</span>
    <span class='co'># plot(m1a$gammas[-1],</span>
    <span class='co'>#      m1l$sigma^2 * c(1, coef(m1l$modelStruct$varStruct, unc = FALSE))^2)</span>


    <span class='co'># The following example shows how to construct a GxE biplot</span>
    <span class='co'># from the FA2 model.</span>

    <span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>besag.met</span>
    <span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/transform.html'>transform</a></span>(<span class='no'>dat</span>, <span class='kw'>xf</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='no'>col</span>), <span class='kw'>yf</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='no'>row</span>))
    <span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>dat</span>[<span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span>(<span class='no'>dat</span>$<span class='no'>county</span>, <span class='no'>dat</span>$<span class='no'>xf</span>, <span class='no'>dat</span>$<span class='no'>yf</span>), ]

    <span class='co'># First, AR1xAR1</span>
    <span class='no'>m1</span> <span class='kw'>&lt;-</span> <span class='fu'>asreml</span>(<span class='no'>yield</span> ~ <span class='no'>county</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>,
                 <span class='kw'>random</span> <span class='kw'>=</span> ~ <span class='no'>gen</span>:<span class='no'>county</span>,
                 <span class='kw'>rcov</span> <span class='kw'>=</span> ~ <span class='fu'>at</span>(<span class='no'>county</span>):<span class='fu'>ar1</span>(<span class='no'>xf</span>):<span class='fu'>ar1</span>(<span class='no'>yf</span>))
    <span class='co'># Add FA1.</span>
    <span class='co'># For ASExtras:::summary.fa, use fa(county,1):gen, NOT gen:fa(county,1)</span>
    <span class='no'>m2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span>(<span class='no'>m1</span>, <span class='kw'>random</span><span class='kw'>=</span>~ <span class='no'>gen</span>:<span class='fu'>fa</span>(<span class='no'>county</span>,<span class='fl'>1</span>))
    <span class='co'># FA2</span>
    <span class='no'>m3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span>(<span class='no'>m2</span>, <span class='kw'>random</span><span class='kw'>=</span>~ <span class='no'>gen</span>:<span class='fu'>fa</span>(<span class='no'>county</span>,<span class='fl'>2</span>))
    <span class='no'>m3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span>(<span class='no'>m3</span>)

    <span class='co'># Use the loadings to make a biplot</span>
    <span class='no'>vars</span> <span class='kw'>&lt;-</span> <span class='fu'>vc</span>(<span class='no'>m3</span>)
    <span class='no'>psi</span> <span class='kw'>&lt;-</span> <span class='no'>vars</span>[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='st'>".var$"</span>, <span class='no'>vars</span>$<span class='no'>effect</span>), <span class='st'>"component"</span>]
    <span class='no'>la1</span> <span class='kw'>&lt;-</span> <span class='no'>vars</span>[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='st'>".fa1$"</span>, <span class='no'>vars</span>$<span class='no'>effect</span>), <span class='st'>"component"</span>]
    <span class='no'>la2</span> <span class='kw'>&lt;-</span> <span class='no'>vars</span>[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='st'>".fa2$"</span>, <span class='no'>vars</span>$<span class='no'>effect</span>), <span class='st'>"component"</span>]
    <span class='no'>mat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='no'>psi</span>, <span class='no'>la1</span>, <span class='no'>la2</span>))
    <span class='no'>rot</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/svd.html'>svd</a></span>(<span class='no'>mat</span>[,-<span class='fl'>1</span>])$<span class='no'>v</span> <span class='co'># rotation matrix</span>
    <span class='no'>lam</span> <span class='kw'>&lt;-</span> <span class='no'>mat</span>[,-<span class='fl'>1</span>]
    <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>lam</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"load1"</span>, <span class='st'>"load2"</span>)

    <span class='no'>co3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>m3</span>)$<span class='no'>random</span> <span class='co'># Scores are the GxE coefficients</span>
    <span class='no'>ix1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='st'>"_Comp1$"</span>, <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>co3</span>))
    <span class='no'>ix2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='st'>"_Comp2$"</span>, <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>co3</span>))
    <span class='no'>sco</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>co3</span>[<span class='no'>ix1</span>], <span class='no'>co3</span>[<span class='no'>ix2</span>]), <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>2</span>, <span class='kw'>byrow</span><span class='kw'>=</span><span class='fl'>FALSE</span>)
    <span class='no'>sco</span> <span class='kw'>&lt;-</span> <span class='no'>sco</span>
    <span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>sco</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span>(<span class='no'>dat</span>$<span class='no'>gen</span>) , <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'load1'</span>,<span class='st'>'load2'</span>))
    <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>lam</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span>(<span class='no'>dat</span>$<span class='no'>county</span>)
    <span class='no'>sco</span>[,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span> * <span class='no'>sco</span>[,<span class='fl'>1</span>]
    <span class='no'>lam</span>[,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span> * <span class='no'>lam</span>[,<span class='fl'>1</span>]
    <span class='fu'><a href='https://rdrr.io/r/stats/biplot.html'>biplot</a></span>(<span class='no'>sco</span>, <span class='no'>lam</span>, <span class='kw'>cex</span><span class='kw'>=</span><span class='fl'>.5</span>, <span class='kw'>main</span><span class='kw'>=</span><span class='st'>"FA2 coefficient biplot (asreml3)"</span>)
    <span class='co'># G variance matrix</span>
    <span class='no'>gvar</span> <span class='kw'>&lt;-</span> <span class='no'>lam</span>

    <span class='co'># Now get predictions and make an ordinary biplot</span>
    <span class='no'>p3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>m3</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>classify</span><span class='kw'>=</span><span class='st'>"county:gen"</span>)
    <span class='no'>p3</span> <span class='kw'>&lt;-</span> <span class='no'>p3</span>$<span class='no'>pred</span>$<span class='no'>pval</span>
    <span class='fu'><a href='libs.html'>libs</a></span>(<span class='st'>"gge"</span>)
    <span class='no'>bi3</span> <span class='kw'>&lt;-</span> <span class='fu'>gge</span>(<span class='no'>p3</span>, <span class='no'>predicted.value</span> ~ <span class='no'>gen</span>*<span class='no'>county</span>, <span class='kw'>scale</span><span class='kw'>=</span><span class='fl'>FALSE</span>)
    <span class='kw'>if</span>(<span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>()) <span class='fu'><a href='https://rdrr.io/r/grDevices/dev.html'>dev.new</a></span>()
    <span class='co'># Very similar to the coefficient biplot</span>
    <span class='fu'><a href='https://rdrr.io/r/stats/biplot.html'>biplot</a></span>(<span class='no'>bi3</span>, <span class='kw'>stand</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='co'># what does 'stand' do?</span>
         <span class='kw'>main</span><span class='kw'>=</span><span class='st'>"SVD biplot of FA2 predictions"</span>)

  }

  <span class='fu'><a href='libs.html'>libs</a></span>(<span class='no'>asreml</span>)
  <span class='kw'>if</span>( <span class='kw pkg'>utils</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/packageDescription.html'>packageVersion</a></span>(<span class='st'>"asreml"</span>) <span class='kw'>&gt;</span>  <span class='st'>"4"</span>) {
    <span class='co'># asreml4</span>

    <span class='co'># Average reps</span>
    <span class='no'>datm</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/aggregate.html'>aggregate</a></span>(<span class='no'>yield</span> ~ <span class='no'>county</span> + <span class='no'>gen</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>FUN</span><span class='kw'>=</span><span class='no'>mean</span>)
    <span class='co'># asreml Using 'rcov' ALWAYS requires sorting the data</span>
    <span class='no'>datm</span> <span class='kw'>&lt;-</span> <span class='no'>datm</span>[<span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span>(<span class='no'>datm</span>$<span class='no'>gen</span>),]

    <span class='no'>m1</span> <span class='kw'>&lt;-</span> <span class='fu'>asreml</span>(<span class='no'>yield</span> ~ <span class='no'>gen</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>datm</span>,
                 <span class='kw'>random</span> <span class='kw'>=</span> ~ <span class='no'>county</span>,
                 <span class='kw'>residual</span> <span class='kw'>=</span> ~ <span class='fu'>dsum</span>( ~ <span class='no'>units</span><span class='kw'>|</span><span class='no'>gen</span>))
    <span class='fu'><a href='libs.html'>libs</a></span>(<span class='no'>lucid</span>)
    <span class='fu'>vc</span>(<span class='no'>m1</span>)[<span class='fl'>1</span>:<span class='fl'>7</span>,]
    <span class='co'>##      effect component std.error z.ratio bound </span>
    <span class='co'>##    county   1324       836.1      1.6     P 0.2</span>
    <span class='co'>## gen_G01!R     91.98     58.91     1.6     P 0.1</span>
    <span class='co'>## gen_G02!R    210.6     133.6      1.6     P 0.1</span>
    <span class='co'>## gen_G03!R     63.06     40.58     1.6     P 0.1</span>
    <span class='co'>## gen_G04!R    112.1      71.59     1.6     P 0.1</span>
    <span class='co'>## gen_G05!R     28.35     18.57     1.5     P 0.2</span>
    <span class='co'>## gen_G06!R    237.4     150.8      1.6     P 0  </span>

    <span class='co'># We get the same results from asreml &amp; lme</span>
    <span class='co'># plot(m1$vparameters[-1],</span>
    <span class='co'>#      m1l$sigma^2 * c(1, coef(m1l$modelStruct$varStruct, unc = FALSE))^2)</span>

    <span class='co'># The following example shows how to construct a GxE biplot</span>
    <span class='co'># from the FA2 model.</span>


    <span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>besag.met</span>
    <span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/transform.html'>transform</a></span>(<span class='no'>dat</span>, <span class='kw'>xf</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='no'>col</span>), <span class='kw'>yf</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='no'>row</span>))
    <span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>dat</span>[<span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span>(<span class='no'>dat</span>$<span class='no'>county</span>, <span class='no'>dat</span>$<span class='no'>xf</span>, <span class='no'>dat</span>$<span class='no'>yf</span>), ]

    <span class='co'># First, AR1xAR1</span>
    <span class='no'>m1</span> <span class='kw'>&lt;-</span> <span class='fu'>asreml</span>(<span class='no'>yield</span> ~ <span class='no'>county</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>,
                 <span class='kw'>random</span> <span class='kw'>=</span> ~ <span class='no'>gen</span>:<span class='no'>county</span>,
                 <span class='kw'>residual</span> <span class='kw'>=</span> ~ <span class='fu'>dsum</span>( ~ <span class='fu'>ar1</span>(<span class='no'>xf</span>):<span class='fu'>ar1</span>(<span class='no'>yf</span>)<span class='kw'>|</span><span class='no'>county</span>))
    <span class='co'># Add FA1</span>
    <span class='no'>m2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span>(<span class='no'>m1</span>, <span class='kw'>random</span><span class='kw'>=</span>~<span class='no'>gen</span>:<span class='fu'>fa</span>(<span class='no'>county</span>,<span class='fl'>1</span>)) <span class='co'># rotate.FA=FALSE</span>
    <span class='co'># FA2</span>
    <span class='no'>m3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span>(<span class='no'>m2</span>, <span class='kw'>random</span><span class='kw'>=</span>~<span class='no'>gen</span>:<span class='fu'>fa</span>(<span class='no'>county</span>,<span class='fl'>2</span>))
    <span class='fu'>asreml.options</span>(<span class='kw'>extra</span><span class='kw'>=</span><span class='fl'>50</span>)
    <span class='no'>m3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span>(<span class='no'>m3</span>, <span class='kw'>maxit</span><span class='kw'>=</span><span class='fl'>50</span>)
    <span class='fu'>asreml.options</span>(<span class='kw'>extra</span><span class='kw'>=</span><span class='fl'>0</span>)

    <span class='co'># Use the loadings to make a biplot</span>
    <span class='no'>vars</span> <span class='kw'>&lt;-</span> <span class='fu'>vc</span>(<span class='no'>m3</span>)
    <span class='no'>psi</span> <span class='kw'>&lt;-</span> <span class='no'>vars</span>[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='st'>"!var$"</span>, <span class='no'>vars</span>$<span class='no'>effect</span>), <span class='st'>"component"</span>]
    <span class='no'>la1</span> <span class='kw'>&lt;-</span> <span class='no'>vars</span>[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='st'>"!fa1$"</span>, <span class='no'>vars</span>$<span class='no'>effect</span>), <span class='st'>"component"</span>]
    <span class='no'>la2</span> <span class='kw'>&lt;-</span> <span class='no'>vars</span>[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='st'>"!fa2$"</span>, <span class='no'>vars</span>$<span class='no'>effect</span>), <span class='st'>"component"</span>]
    <span class='no'>mat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='no'>psi</span>, <span class='no'>la1</span>, <span class='no'>la2</span>))
    <span class='co'># I tried using rotate.fa=FALSE, but it did not seem to</span>
    <span class='co'># give orthogonal vectors.  Rotate by hand.</span>
    <span class='no'>rot</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/svd.html'>svd</a></span>(<span class='no'>mat</span>[,-<span class='fl'>1</span>])$<span class='no'>v</span> <span class='co'># rotation matrix</span>
    <span class='no'>lam</span> <span class='kw'>&lt;-</span> <span class='no'>mat</span>[,-<span class='fl'>1</span>]
    <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>lam</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"load1"</span>, <span class='st'>"load2"</span>)

    <span class='no'>co3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>m3</span>)$<span class='no'>random</span> <span class='co'># Scores are the GxE coefficients</span>
    <span class='no'>ix1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='st'>"_Comp1$"</span>, <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>co3</span>))
    <span class='no'>ix2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='st'>"_Comp2$"</span>, <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>co3</span>))
    <span class='no'>sco</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>co3</span>[<span class='no'>ix1</span>], <span class='no'>co3</span>[<span class='no'>ix2</span>]), <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>2</span>, <span class='kw'>byrow</span><span class='kw'>=</span><span class='fl'>FALSE</span>)
    <span class='no'>sco</span> <span class='kw'>&lt;-</span> <span class='no'>sco</span>
    <span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>sco</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span>(<span class='no'>dat</span>$<span class='no'>gen</span>) , <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'load1'</span>,<span class='st'>'load2'</span>))
    <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>lam</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span>(<span class='no'>dat</span>$<span class='no'>county</span>)
    <span class='no'>sco</span>[,<span class='fl'>1</span>:<span class='fl'>2</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span> * <span class='no'>sco</span>[,<span class='fl'>1</span>:<span class='fl'>2</span>]
    <span class='no'>lam</span>[,<span class='fl'>1</span>:<span class='fl'>2</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span> * <span class='no'>lam</span>[,<span class='fl'>1</span>:<span class='fl'>2</span>]
    <span class='fu'><a href='https://rdrr.io/r/stats/biplot.html'>biplot</a></span>(<span class='no'>sco</span>, <span class='no'>lam</span>, <span class='kw'>cex</span><span class='kw'>=</span><span class='fl'>.5</span>, <span class='kw'>main</span><span class='kw'>=</span><span class='st'>"FA2 coefficient biplot (asreml4)"</span>)
    <span class='co'># G variance matrix</span>
    <span class='no'>gvar</span> <span class='kw'>&lt;-</span> <span class='no'>lam</span>

  <span class='co'># Now get predictions and make an ordinary biplot</span>
  <span class='no'>p3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>m3</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>classify</span><span class='kw'>=</span><span class='st'>"county:gen"</span>)
  <span class='no'>p3</span> <span class='kw'>&lt;-</span> <span class='no'>p3</span>$<span class='no'>pvals</span>
  <span class='fu'><a href='libs.html'>libs</a></span>(<span class='st'>"gge"</span>)
  <span class='no'>bi3</span> <span class='kw'>&lt;-</span> <span class='fu'>gge</span>(<span class='no'>p3</span>, <span class='no'>predicted.value</span> ~ <span class='no'>gen</span>*<span class='no'>county</span>, <span class='kw'>scale</span><span class='kw'>=</span><span class='fl'>FALSE</span>)
  <span class='kw'>if</span>(<span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>()) <span class='fu'><a href='https://rdrr.io/r/grDevices/dev.html'>dev.new</a></span>()
  <span class='co'># Very similar to the coefficient biplot</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/biplot.html'>biplot</a></span>(<span class='no'>bi3</span>, <span class='kw'>stand</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>main</span><span class='kw'>=</span><span class='st'>"SVD biplot of FA2 predictions"</span>)

}</div><div class='output co'>#&gt; Multi-section model using the sigma parameterization.
#&gt; ASReml 4.1.0 Thu Jul 30 15:47:27 2020
#&gt;           LogLik        Sigma2     DF     wall    cpu
#&gt;  1     -1172.163           1.0    320 15:47:27    0.0 (60 restrained)
#&gt;  2     -1011.805           1.0    320 15:47:27    0.0 (1 restrained)
#&gt;  3      -970.591           1.0    320 15:47:27    0.0
#&gt;  4      -940.691           1.0    320 15:47:27    0.0
#&gt;  5      -927.170           1.0    320 15:47:27    0.0
#&gt;  6      -923.727           1.0    320 15:47:27    0.0
#&gt;  7      -923.239           1.0    320 15:47:27    0.0
#&gt;  8      -922.976           1.0    320 15:47:27    0.0
#&gt;  9      -922.903           1.0    320 15:47:27    0.0
#&gt; 10      -922.899           1.0    320 15:47:27    0.0
#&gt; Multi-section model using the sigma parameterization.
#&gt; ASReml 4.1.0 Thu Jul 30 15:47:28 2020
#&gt;           LogLik        Sigma2     DF     wall    cpu
#&gt;  1     -3931.453           1.0   1146 15:47:28    0.0
#&gt;  2     -3846.882           1.0   1146 15:47:28    0.0
#&gt;  3     -3765.127           1.0   1146 15:47:28    0.0
#&gt;  4     -3724.260           1.0   1146 15:47:28    0.0
#&gt;  5     -3710.877           1.0   1146 15:47:28    0.0
#&gt;  6     -3709.388           1.0   1146 15:47:28    0.0
#&gt;  7     -3709.308           1.0   1146 15:47:28    0.0
#&gt;  8     -3709.304           1.0   1146 15:47:28    0.0
#&gt; Multi-section model using the sigma parameterization.
#&gt; ASReml 4.1.0 Thu Jul 30 15:47:28 2020
#&gt;           LogLik        Sigma2     DF     wall    cpu
#&gt;  1     -3960.869           1.0   1146 15:47:28    0.1 (1 restrained)
#&gt;  2     -3838.939           1.0   1146 15:47:28    0.0
#&gt;  3     -3738.501           1.0   1146 15:47:28    0.0
#&gt;  4     -3685.886           1.0   1146 15:47:28    0.0
#&gt;  5     -3667.580           1.0   1146 15:47:28    0.0
#&gt;  6     -3665.255           1.0   1146 15:47:28    0.0
#&gt;  7     -3665.089           1.0   1146 15:47:28    0.0
#&gt;  8     -3665.077           1.0   1146 15:47:28    0.1
#&gt;  9     -3665.076           1.0   1146 15:47:28    0.0
#&gt; Multi-section model using the sigma parameterization.
#&gt; ASReml 4.1.0 Thu Jul 30 15:47:28 2020
#&gt;           LogLik        Sigma2     DF     wall    cpu
#&gt;  1     -3960.862           1.0   1146 15:47:28    0.1 (1 restrained)
#&gt;  2     -3926.560           1.0   1146 15:47:28    0.0 (1 restrained)
#&gt;  3     -3833.085           1.0   1146 15:47:29    0.0 (1 restrained)
#&gt;  4     -3735.147           1.0   1146 15:47:29    0.0 (1 restrained)
#&gt;  5     -3683.543           1.0   1146 15:47:29    0.0 (1 restrained)
#&gt;  6     -3665.368           1.0   1146 15:47:29    0.0
#&gt;  7     -3662.711           1.0   1146 15:47:29    0.0
#&gt;  8     -3662.471           1.0   1146 15:47:29    0.0
#&gt;  9     -3662.452           1.0   1146 15:47:29    0.0
#&gt; 10     -3662.449           1.0   1146 15:47:29    0.0
#&gt; 11     -3662.449           1.0   1146 15:47:29    0.0</div><div class='output co'>#&gt; <span class='warning'>Warning: Some components changed by more than 1% on the last iteration.</span></div><div class='output co'>#&gt; Multi-section model using the sigma parameterization.
#&gt; ASReml 4.1.0 Thu Jul 30 15:47:29 2020
#&gt;           LogLik        Sigma2     DF     wall    cpu
#&gt;  1     -3662.448           1.0   1146 15:47:29    0.1
#&gt;  2     -3662.448           1.0   1146 15:47:29    0.0
#&gt;  3     -3662.448           1.0   1146 15:47:29    0.0
#&gt;  4     -3662.448           1.0   1146 15:47:29    0.0
#&gt;  5     -3662.448           1.0   1146 15:47:29    0.0
#&gt;  6     -3662.448           1.0   1146 15:47:29    0.0
#&gt;  7     -3662.448           1.0   1146 15:47:29    0.0
#&gt;  8     -3662.448           1.0   1146 15:47:29    0.0
#&gt;  9     -3662.448           1.0   1146 15:47:29    0.0
#&gt; 10     -3662.448           1.0   1146 15:47:29    0.0
#&gt; 11     -3662.448           1.0   1146 15:47:30    0.0
#&gt; 12     -3662.448           1.0   1146 15:47:30    0.0
#&gt; 13     -3662.448           1.0   1146 15:47:30    0.0
#&gt; 14     -3662.448           1.0   1146 15:47:30    0.0
#&gt; 15     -3662.448           1.0   1146 15:47:30    0.0
#&gt; 16     -3662.448           1.0   1146 15:47:30    0.0
#&gt; 17     -3662.448           1.0   1146 15:47:30    0.0
#&gt; 18     -3662.448           1.0   1146 15:47:30    0.0
#&gt; 19     -3662.448           1.0   1146 15:47:30    0.0
#&gt; 20     -3662.448           1.0   1146 15:47:30    0.0
#&gt; 21     -3662.448           1.0   1146 15:47:30    0.0
#&gt; 22     -3662.448           1.0   1146 15:47:30    0.0
#&gt; 23     -3662.447           1.0   1146 15:47:30    0.0
#&gt; 24     -3662.447           1.0   1146 15:47:30    0.0
#&gt; 25     -3662.447           1.0   1146 15:47:30    0.0
#&gt; 26     -3662.447           1.0   1146 15:47:30    0.0
#&gt; 27     -3662.447           1.0   1146 15:47:30    0.0
#&gt; 28     -3662.447           1.0   1146 15:47:30    0.0
#&gt; 29     -3662.447           1.0   1146 15:47:30    0.0
#&gt; 30     -3662.447           1.0   1146 15:47:30    0.0
#&gt; 31     -3662.447           1.0   1146 15:47:30    0.0
#&gt; 32     -3662.447           1.0   1146 15:47:30    0.0
#&gt; 33     -3662.447           1.0   1146 15:47:30    0.0
#&gt; 34     -3662.447           1.0   1146 15:47:30    0.0
#&gt; 35     -3662.447           1.0   1146 15:47:30    0.0
#&gt; 36     -3662.447           1.0   1146 15:47:31    0.0
#&gt; 37     -3662.447           1.0   1146 15:47:31    0.0
#&gt; 38     -3662.447           1.0   1146 15:47:31    0.0
#&gt; 39     -3662.447           1.0   1146 15:47:31    0.0
#&gt; 40     -3662.447           1.0   1146 15:47:31    0.0
#&gt; 41     -3662.447           1.0   1146 15:47:31    0.0
#&gt; 42     -3662.447           1.0   1146 15:47:31    0.0
#&gt; 43     -3662.447           1.0   1146 15:47:31    0.0
#&gt; 44     -3662.447           1.0   1146 15:47:31    0.0
#&gt; 45     -3662.447           1.0   1146 15:47:31    0.0
#&gt; 46     -3662.447           1.0   1146 15:47:31    0.0
#&gt; 47     -3662.447           1.0   1146 15:47:31    0.0
#&gt; 48     -3662.446           1.0   1146 15:47:31    0.0
#&gt; 49     -3662.446           1.0   1146 15:47:31    0.0
#&gt; 50     -3662.446           1.0   1146 15:47:31    0.0</div><div class='output co'>#&gt; <span class='warning'>Warning: Some components changed by more than 1% on the last iteration.</span></div><div class='output co'>#&gt; Multi-section model using the sigma parameterization.
#&gt; ASReml 4.1.0 Thu Jul 30 15:47:31 2020
#&gt;           LogLik        Sigma2     DF     wall    cpu
#&gt;  1     -3662.446           1.0   1146 15:47:31    0.1
#&gt;  2     -3662.446           1.0   1146 15:47:31    0.0
#&gt;  3     -3662.446           1.0   1146 15:47:32    0.1</div><div class='output co'>#&gt; <span class='warning'>Warning: Some components changed by more than 1% on the last iteration.</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: 'gge'</span></div><div class='output co'>#&gt; <span class='message'>The following object is masked from 'package:desplot':</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    RedGrayBlue</span></div><div class='img'><img src='besag.met-2.png' alt='' width='700' height='433' /></div><div class='img'><img src='besag.met-3.png' alt='' width='700' height='433' /></div><div class='input'># }
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Kevin Wright.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


